<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Portal Management - AI Agent & Productivity Tool</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .sidebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
        }
        .sidebar .nav-link:hover {
            color: white;
            background: rgba(255,255,255,0.1);
        }
        .main-content {
            background: #f8f9fa;
            min-height: 100vh;
        }
        .card {
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            transition: all 0.3s;
        }
        .card:hover {
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }
        .status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }
        .portal-card {
            border-left: 4px solid #007bff;
        }
        .portal-card.success {
            border-left-color: #28a745;
        }
        .portal-card.warning {
            border-left-color: #ffc107;
        }
        .portal-card.danger {
            border-left-color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-3 col-lg-2 sidebar p-3">
                <h4 class="mb-4"><i class="fas fa-robot"></i> AI Agent</h4>
                <nav class="nav flex-column">
                    <a class="nav-link" href="/"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                    <a class="nav-link active" href="/job-portal"><i class="fas fa-briefcase"></i> Job Portal</a>
                    <a class="nav-link" href="/email-monitor"><i class="fas fa-envelope"></i> Email Monitor</a>
                    <a class="nav-link" href="/gcc-jobs"><i class="fas fa-search"></i> GCC Jobs</a>
                    <a class="nav-link" href="/cv-optimizer"><i class="fas fa-file-alt"></i> CV Optimizer</a>
                    <a class="nav-link" href="/data-scraper"><i class="fas fa-database"></i> Data Scraper</a>
                    <a class="nav-link" href="/scheduler"><i class="fas fa-clock"></i> Scheduler</a>
                </nav>
            </div>

            <!-- Main Content -->
            <div class="col-md-9 col-lg-10 main-content p-4">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2><i class="fas fa-briefcase"></i> Job Portal Management</h2>
                    <div>
                        <button class="btn btn-info me-2" onclick="testPortalConnection('indeed')">
                            <i class="fas fa-plug"></i> Test Indeed Connection
                        </button>
                        <button class="btn btn-success me-2" onclick="testPortalConnection('bayt')">
                            <i class="fas fa-plug"></i> Test Bayt Connection
                        </button>
                        <button class="btn btn-warning me-2" onclick="refreshCV('bayt')">
                            <i class="fas fa-file-alt"></i> Refresh CV
                        </button>
                        <button class="btn btn-primary" onclick="runDailyUpdates()">
                            <i class="fas fa-sync-alt"></i> Run Daily Updates
                        </button>
                    </div>
                </div>

                <!-- Statistics Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-portal fa-2x text-primary mb-2"></i>
                                <h5 class="card-title">Active Portals</h5>
                                <h3 class="text-primary" id="activePortals">3</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-clock fa-2x text-success mb-2"></i>
                                <h5 class="card-title">Last Update</h5>
                                <h6 class="text-success" id="lastUpdate">2 hours ago</h6>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-check-circle fa-2x text-info mb-2"></i>
                                <h5 class="card-title">Success Rate</h5>
                                <h3 class="text-info" id="successRate">95%</h3>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-center">
                            <div class="card-body">
                                <i class="fas fa-calendar fa-2x text-warning mb-2"></i>
                                <h5 class="card-title">Next Update</h5>
                                <h6 class="text-warning" id="nextUpdate">Tomorrow 9:00 AM</h6>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Add New Portal Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-plus"></i> Add New Job Portal</h5>
                                <button class="btn btn-success" onclick="showAddPortalModal()">
                                    <i class="fas fa-plus"></i> Add New Portal
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <h6>Quick Add Popular Portals</h6>
                                        <div class="d-flex flex-wrap gap-2">
                                            <button class="btn btn-outline-primary btn-sm" onclick="quickAddPortal('LinkedIn')">
                                                <i class="fab fa-linkedin"></i> LinkedIn
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="quickAddPortal('Indeed')">
                                                <i class="fas fa-search"></i> Indeed
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="quickAddPortal('Bayt.com')">
                                                <i class="fas fa-briefcase"></i> Bayt.com
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="quickAddPortal('GulfTalent')">
                                                <i class="fas fa-globe"></i> GulfTalent
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="quickAddPortal('Naukrigulf')">
                                                <i class="fas fa-building"></i> Naukrigulf
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <h6>Portal Management</h6>
                                        <p class="text-muted small">Add custom job portals or configure existing ones. Each portal will be automatically updated daily to show active job seeking.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Job Portals -->
                <div class="row">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5><i class="fas fa-list"></i> Configured Job Portals</h5>
                                <span class="badge bg-primary" id="portalCount">3 Active</span>
                            </div>
                            <div class="card-body">
                                <div class="row" id="portalsList">
                                    <!-- Portal cards will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <h5><i class="fas fa-history"></i> Recent Activity</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>Portal</th>
                                                <th>Action</th>
                                                <th>Status</th>
                                                <th>Time</th>
                                            </tr>
                                        </thead>
                                        <tbody id="activityTable">
                                            <!-- Activity rows will be loaded here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Portal Configuration -->
    <div class="modal fade" id="portalConfigModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Configure Job Portal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="portalConfigForm">
                        <div class="mb-3">
                            <label class="form-label">Portal Name</label>
                            <input type="text" class="form-control" id="portalName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-control" id="portalUsername" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-control" id="portalPassword" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Update Fields</label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="profileCompletion" checked>
                                <label class="form-check-label">Profile Completion</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="jobPreferences" checked>
                                <label class="form-check-label">Job Preferences</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="skillsEndorsements" checked>
                                <label class="form-check-label">Skills Endorsements</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="activityStatus" checked>
                                <label class="form-check-label">Activity Status</label>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="savePortalConfig()">Save Configuration</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal for Adding New Portal -->
    <div class="modal fade" id="addPortalModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Add New Job Portal</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addPortalForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Portal Name *</label>
                                    <input type="text" class="form-control" id="newPortalName" placeholder="e.g., LinkedIn, Indeed" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Portal URL</label>
                                    <input type="url" class="form-control" id="newPortalUrl" placeholder="https://www.portal.com">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Username/Email *</label>
                                    <input type="text" class="form-control" id="newPortalUsername" placeholder="your.email@example.com" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Password *</label>
                                    <input type="password" class="form-control" id="newPortalPassword" placeholder="Enter password" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Update Frequency</label>
                                    <select class="form-select" id="newPortalFrequency">
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Update Fields</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newProfileCompletion" checked>
                                        <label class="form-check-label">Profile Completion</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newJobPreferences" checked>
                                        <label class="form-check-label">Job Preferences</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newSkillsEndorsements" checked>
                                        <label class="form-check-label">Skills Endorsements</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newActivityStatus" checked>
                                        <label class="form-check-label">Activity Status</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newProfilePicture" checked>
                                        <label class="form-check-label">Profile Picture</label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newContactInfo" checked>
                                        <label class="form-check-label">Contact Information</label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Notes</label>
                                    <textarea class="form-control" id="newPortalNotes" rows="3" placeholder="Any additional notes about this portal..."></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="saveNewPortal()">
                        <i class="fas fa-save"></i> Save Portal
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Sample data for demonstration
        let samplePortals = [
            { name: 'LinkedIn', status: 'success', lastUpdate: '2 hours ago', nextUpdate: 'Tomorrow 9:00 AM', url: 'https://linkedin.com', username: 'user@example.com', frequency: 'daily' },
            { name: 'Indeed', status: 'warning', lastUpdate: '1 day ago', nextUpdate: 'Today 3:00 PM', url: 'https://indeed.com', username: 'user@example.com', frequency: 'daily' },
            { name: 'Bayt.com', status: 'danger', lastUpdate: '3 days ago', nextUpdate: 'Today 6:00 PM', url: 'https://bayt.com', username: 'user@example.com', frequency: 'daily' }
        ];

        const sampleActivity = [
            { portal: 'LinkedIn', action: 'Profile Update', status: 'Success', time: '2 hours ago' },
            { portal: 'Indeed', action: 'Skills Endorsement', status: 'Pending', time: '1 day ago' },
            { portal: 'Bayt.com', action: 'Job Preferences', status: 'Failed', time: '3 days ago' }
        ];

        function loadPortals() {
            const portalsList = document.getElementById('portalsList');
            const portalCount = document.getElementById('portalCount');
            portalsList.innerHTML = '';

            samplePortals.forEach(portal => {
                const portalCard = document.createElement('div');
                portalCard.className = `col-md-4 mb-3`;
                portalCard.innerHTML = `
                    <div class="card portal-card ${portal.status}">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6 class="card-title">${portal.name}</h6>
                                    <p class="card-text small text-muted">Last Update: ${portal.lastUpdate}</p>
                                    <p class="card-text small text-muted">Next Update: ${portal.nextUpdate}</p>
                                    <p class="card-text small text-muted">Frequency: ${portal.frequency}</p>
                                </div>
                                <span class="badge bg-${portal.status === 'success' ? 'success' : portal.status === 'warning' ? 'warning' : 'danger'} status-badge">
                                    ${portal.status}
                                </span>
                            </div>
                            <div class="mt-3">
                                <button class="btn btn-sm btn-outline-primary me-2" onclick="configurePortal('${portal.name}')">
                                    <i class="fas fa-cog"></i> Configure
                                </button>
                                <button class="btn btn-sm btn-outline-success me-2" onclick="updatePortal('${portal.name}')">
                                    <i class="fas fa-sync-alt"></i> Update Now
                                </button>
                                <button class="btn btn-sm btn-outline-danger" onclick="removePortal('${portal.name}')">
                                    <i class="fas fa-trash"></i> Remove
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                portalsList.appendChild(portalCard);
            });

            // Update portal count
            portalCount.textContent = `${samplePortals.length} Active`;
        }

        function loadActivity() {
            const activityTable = document.getElementById('activityTable');
            activityTable.innerHTML = '';

            sampleActivity.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${activity.portal}</td>
                    <td>${activity.action}</td>
                    <td><span class="badge bg-${activity.status === 'Success' ? 'success' : activity.status === 'Pending' ? 'warning' : 'danger'}">${activity.status}</span></td>
                    <td>${activity.time}</td>
                `;
                activityTable.appendChild(row);
            });
        }

        function testPortalConnection(portalName) {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Testing...';
            button.disabled = true;

            fetch('/api/test-portal-connection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    portal_name: portalName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    const result = data.result;
                    let alertType = 'info';
                    if (result.status === 'success') alertType = 'success';
                    else if (result.status === 'warning') alertType = 'warning';
                    else if (result.status === 'error') alertType = 'danger';
                    
                    showAlert(`${result.portal}: ${result.message}`, alertType);
                } else {
                    showAlert('Error testing portal connection: ' + data.error, 'danger');
                }
            })
            .catch(error => {
                showAlert('Error: ' + error.message, 'danger');
            })
            .finally(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }

        function runDailyUpdates() {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Running...';
            button.disabled = true;

            fetch('/api/run-daily-updates', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showAlert('Daily updates completed successfully!', 'success');
                    loadPortals();
                    loadActivity();
                } else {
                    showAlert('Error running daily updates: ' + data.error, 'danger');
                }
            })
            .catch(error => {
                showAlert('Error: ' + error.message, 'danger');
            })
            .finally(() => {
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }

        function refreshCV(portalName) {
            const button = event.target;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Refreshing...';
            button.disabled = true;

            // Add timeout to prevent infinite loading
            const timeout = setTimeout(() => {
                button.innerHTML = originalText;
                button.disabled = false;
                showAlert('Operation timed out. Please try again.', 'warning');
            }, 60000); // 60 second timeout

            fetch('/api/refresh-cv', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    portal_name: portalName
                })
            })
            .then(response => response.json())
            .then(data => {
                clearTimeout(timeout); // Clear timeout on success/failure
                if (data.success) {
                    // Check if it's a mock response
                    if (data.message && data.message.includes('Mock')) {
                        showAlert('CV refresh simulated (real automation blocked by anti-bot protection). Job position update may have worked.', 'info');
                    } else {
                        showAlert('CV refreshed successfully!', 'success');
                    }
                    addActivityLog(portalName, 'CV Refresh', 'Success');
                } else {
                    showAlert('Error refreshing CV: ' + data.error, 'danger');
                    addActivityLog(portalName, 'CV Refresh', 'Failed');
                }
            })
            .catch(error => {
                clearTimeout(timeout); // Clear timeout on error
                showAlert('Error: ' + error.message, 'danger');
                addActivityLog(portalName, 'CV Refresh', 'Failed');
            })
            .finally(() => {
                clearTimeout(timeout); // Ensure timeout is cleared
                button.innerHTML = originalText;
                button.disabled = false;
            });
        }

        function configurePortal(portalName) {
            document.getElementById('portalName').value = portalName;
            const modal = new bootstrap.Modal(document.getElementById('portalConfigModal'));
            modal.show();
        }

        function updatePortal(portalName) {
            showAlert(`Updating ${portalName}...`, 'info');
            // Simulate update process
            setTimeout(() => {
                showAlert(`${portalName} updated successfully!`, 'success');
                loadPortals();
            }, 2000);
        }

        function savePortalConfig() {
            const portalName = document.getElementById('portalName').value;
            showAlert(`Configuration saved for ${portalName}!`, 'success');
            bootstrap.Modal.getInstance(document.getElementById('portalConfigModal')).hide();
        }

        function showAddPortalModal() {
            // Clear form
            document.getElementById('addPortalForm').reset();
            const modal = new bootstrap.Modal(document.getElementById('addPortalModal'));
            modal.show();
        }

        function quickAddPortal(portalName) {
            // Pre-fill the form with common portal data
            document.getElementById('newPortalName').value = portalName;
            
            // Set default URLs for popular portals
            const portalUrls = {
                'LinkedIn': 'https://linkedin.com',
                'Indeed': 'https://indeed.com',
                'Bayt.com': 'https://bayt.com',
                'GulfTalent': 'https://gulftalent.com',
                'Naukrigulf': 'https://naukrigulf.com'
            };
            
            if (portalUrls[portalName]) {
                document.getElementById('newPortalUrl').value = portalUrls[portalName];
            }
            
            const modal = new bootstrap.Modal(document.getElementById('addPortalModal'));
            modal.show();
        }

        function saveNewPortal() {
            const portalName = document.getElementById('newPortalName').value.trim();
            const portalUrl = document.getElementById('newPortalUrl').value.trim();
            const username = document.getElementById('newPortalUsername').value.trim();
            const password = document.getElementById('newPortalPassword').value;
            const frequency = document.getElementById('newPortalFrequency').value;
            const notes = document.getElementById('newPortalNotes').value.trim();

            // Validate required fields
            if (!portalName || !username || !password) {
                showAlert('Please fill in all required fields!', 'danger');
                return;
            }

            // Check if portal already exists
            if (samplePortals.some(portal => portal.name.toLowerCase() === portalName.toLowerCase())) {
                showAlert('A portal with this name already exists!', 'danger');
                return;
            }

            // Create new portal object
            const newPortal = {
                name: portalName,
                status: 'success',
                lastUpdate: 'Never',
                nextUpdate: 'Tomorrow 9:00 AM',
                url: portalUrl,
                username: username,
                frequency: frequency,
                notes: notes,
                addedDate: new Date().toLocaleDateString()
            };

            // Add to portals list
            samplePortals.push(newPortal);

            // Save to localStorage (simulating database save)
            localStorage.setItem('jobPortals', JSON.stringify(samplePortals));

            // Close modal and refresh
            bootstrap.Modal.getInstance(document.getElementById('addPortalModal')).hide();
            loadPortals();
            showAlert(`Portal "${portalName}" added successfully!`, 'success');

            // Add to activity log
            addActivityLog(portalName, 'Portal Added', 'Success');
        }

        function removePortal(portalName) {
            if (confirm(`Are you sure you want to remove "${portalName}" from your job portals?`)) {
                samplePortals = samplePortals.filter(portal => portal.name !== portalName);
                localStorage.setItem('jobPortals', JSON.stringify(samplePortals));
                loadPortals();
                showAlert(`Portal "${portalName}" removed successfully!`, 'success');
                addActivityLog(portalName, 'Portal Removed', 'Success');
            }
        }

        function addActivityLog(portal, action, status) {
            const newActivity = {
                portal: portal,
                action: action,
                status: status,
                time: 'Just now'
            };
            
            // Add to beginning of activity list
            sampleActivity.unshift(newActivity);
            
            // Keep only last 10 activities
            if (sampleActivity.length > 10) {
                sampleActivity = sampleActivity.slice(0, 10);
            }
            
            loadActivity();
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.top = '20px';
            alertDiv.style.right = '20px';
            alertDiv.style.zIndex = '9999';
            alertDiv.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.body.appendChild(alertDiv);
            setTimeout(() => alertDiv.remove(), 5000);
        }

        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved portals from localStorage
            const savedPortals = localStorage.getItem('jobPortals');
            if (savedPortals) {
                try {
                    const parsedPortals = JSON.parse(savedPortals);
                    if (parsedPortals.length > 0) {
                        samplePortals = parsedPortals;
                    }
                } catch (e) {
                    console.log('Error loading saved portals, using defaults');
                }
            }
            
            loadPortals();
            loadActivity();
        });
    </script>
</body>
</html> 